generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                       String                    @id @default(cuid())
  name                     String                    @unique
  email                    String                    @unique
  emailVerified            Boolean
  image                    String?
  role                     Roles                     @default(utilisateur)
  plan                     Plan                      @default(free)
  clientId                 String?                   @unique
  resetToken               String?
  resetTokenExpiry         DateTime?
  createdAt                DateTime
  updatedAt                DateTime
  Convocation              Convocation[]
  MembreEquipe             MembreEquipe[]
  abonnement               Abonnement?
  accounts                 Account[]
  blessures                Blessure[]
  conversationParticipants ConversationParticipant[]
  demandesAdhesion         DemandeAdhesion[]
  finances                 Finance[]
  sentMessages             Message[]
  notifications            Notification[]
  presences                Presence[]
  reponsesSondages         ReponseSondage[]
  sessions                 Session[]
  sondagesCrees            Sondage[]
  statsJoueur              StatistiqueJoueur[]
  clubsFavoris             Equipe[]                  @relation("ClubsFavoris")
  user_A                   User[]                    @relation("JoueursFavoris")
  user_B                   User[]                    @relation("JoueursFavoris")
  isOnline                 Boolean                   @default(false)
  lastSeen                 DateTime?
  messageDeletions         MessageDeletion[]

  @@map("user")
}

model Equipe {
  id             String              @id @default(cuid())
  nom            String
  description    String?
  logoUrl        String?
  dateCreation   DateTime            @default(now())
  codeInvitation String?
  statut         StatutClub          @default(PUBLIC)
  niveau         NiveauClub          @default(LOISIR)
  MembreEquipe   MembreEquipe[]
  blessures      Blessure[]
  demandes       DemandeAdhesion[]
  evenements     Evenement[]
  finances       Finance[]
  sondages       Sondage[]
  statsEquipe    StatistiqueEquipe[]
  dansFavorisDe  User[]              @relation("ClubsFavoris")

  @@map("equipe")
}

model MembreEquipe {
  id         String       @id @default(cuid())
  role       RoleEquipe   @default(JOUEUR)
  poste      PosteJoueur?
  isLicensed Boolean      @default(false)
  joinedAt   DateTime     @default(now())
  userId     String
  equipeId   String
  equipe     Equipe       @relation(fields: [equipeId], references: [id], onDelete: Cascade)
  user       User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, equipeId])
  @@map("MembreEquipe")
}

model DemandeAdhesion {
  id         String        @id @default(cuid())
  poste      PosteJoueur
  motivation String
  statut     StatutDemande @default(ATTENTE)
  createdAt  DateTime      @default(now())
  userId     String
  equipeId   String
  niveau     NiveauClub
  equipe     Equipe        @relation(fields: [equipeId], references: [id], onDelete: Cascade)
  user       User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("demande_adhesion")
}

model Blessure {
  id          String   @id @default(cuid())
  type        String
  description String?
  startDate   DateTime
  endDate     DateTime
  isRecurring Boolean  @default(false)
  userId      String
  equipeId    String
  equipe      Equipe   @relation(fields: [equipeId], references: [id], onDelete: Cascade)
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, startDate])
  @@map("blessure")
}

model Finance {
  id           String      @id @default(cuid())
  montant      Float
  type         TypeFinance
  description  String
  isPaid       Boolean     @default(false)
  dateEcheance DateTime?
  userId       String
  equipeId     String
  equipe       Equipe      @relation(fields: [equipeId], references: [id], onDelete: Cascade)
  user         User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("finance")
}

model Convocation {
  id          String            @id @default(cuid())
  userId      String
  evenementId String
  statut      StatutConvocation @default(EN_ATTENTE)
  dateEnvoi   DateTime          @default(now())
  dateReponse DateTime?
  evenement   Evenement         @relation(fields: [evenementId], references: [id], onDelete: Cascade)
  user        User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, evenementId])
  @@index([evenementId, statut])
}

model Evenement {
  id            String              @id @default(cuid())
  titre         String
  description   String?
  lieu          String?
  typeEvenement TypeEvenement       @default(ENTRAINEMENT)
  dateDebut     DateTime
  dateCreation  DateTime            @default(now())
  adversaire    String?
  locationData  Json?
  weatherData   Json?
  equipeId      String
  Convocation   Convocation[]
  equipe        Equipe              @relation(fields: [equipeId], references: [id], onDelete: Cascade)
  presences     Presence[]
  statEquipe    StatistiqueEquipe?
  statsJoueur   StatistiqueJoueur[]

  @@index([equipeId])
  @@map("evenement")
}

model Sondage {
  id         String           @id @default(cuid())
  question   String
  options    String[]
  isMulti    Boolean          @default(false)
  expiresAt  DateTime?
  createdAt  DateTime         @default(now())
  createurId String
  equipeId   String
  reponses   ReponseSondage[]
  createur   User             @relation(fields: [createurId], references: [id], onDelete: Cascade)
  equipe     Equipe           @relation(fields: [equipeId], references: [id], onDelete: Cascade)

  @@map("sondage")
}

model ReponseSondage {
  id            String   @id @default(cuid())
  choix         String
  createdAt     DateTime @default(now())
  utilisateurId String
  sondageId     String
  sondage       Sondage  @relation(fields: [sondageId], references: [id], onDelete: Cascade)
  utilisateur   User     @relation(fields: [utilisateurId], references: [id], onDelete: Cascade)

  @@map("reponse_sondage")
}

model Abonnement {
  id        String         @id @default(cuid())
  userId    String         @unique
  plan      Plan
  periode   PlanAbonnement
  datedebut DateTime       @default(now())
  datefin   DateTime       @updatedAt
  user      User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("abonnement")
}

model Session {
  id        String   @id
  expiresAt DateTime
  token     String   @unique
  createdAt DateTime
  updatedAt DateTime
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("session")
}

model Account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime
  updatedAt             DateTime
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("account")
}

model Verification {
  id         String    @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime?
  updatedAt  DateTime?

  @@map("verification")
}

model Presence {
  id           String         @id @default(cuid())
  statut       StatutPresence @default(ATTENTE)
  dateCreation DateTime       @default(now())
  userId       String
  evenementId  String
  evenement    Evenement      @relation(fields: [evenementId], references: [id], onDelete: Cascade)
  user         User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, evenementId])
  @@map("presence")
}

model StatistiqueJoueur {
  id             String      @id @default(cuid())
  buts           Int         @default(0)
  passesdecisive Int         @default(0)
  note           Float       @default(6.0)
  minutesJouees  Int         @default(0)
  titulaire      Boolean     @default(false)
  poste          PosteJoueur
  dateCreation   DateTime    @default(now())
  userId         String
  evenementId    String
  evenement      Evenement   @relation(fields: [evenementId], references: [id], onDelete: Cascade)
  user           User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, evenementId])
  @@map("statistique_joueur")
}

model StatistiqueEquipe {
  id            String        @id @default(cuid())
  resultatMatch ResultatMatch
  butsMarques   Int           @default(0)
  butsEncaisses Int           @default(0)
  cleanSheet    Boolean       @default(false)
  tirsTotal     Int?
  tirsCadres    Int?
  domicile      Boolean       @default(true)
  competition   competition   @default(CHAMPIONNAT)
  adversaire    String
  dateCreation  DateTime      @default(now())
  equipeId      String
  evenementId   String?       @unique
  equipe        Equipe        @relation(fields: [equipeId], references: [id], onDelete: Cascade)
  evenement     Evenement?    @relation(fields: [evenementId], references: [id], onDelete: Cascade)

  @@index([equipeId])
  @@map("statistique_equipe")
}

model Notification {
  id            String           @id @default(cuid())
  type          TypeNotification
  title         String
  message       String
  data          Json?
  read          Boolean          @default(false)
  delivered     Boolean          @default(false)
  createdAt     DateTime         @default(now())
  userId        String
  fromUserImage String?
  fromUserName  String?
  user          User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, read])
  @@index([userId, delivered])
  @@index([createdAt])
  @@map("notification")
}

model Conversation {
  id           String                    @id @default(cuid())
  type         ConversationType          @default(PRIVATE)
  name         String?
  createdAt    DateTime                  @default(now())
  updatedAt    DateTime                  @updatedAt
  participants ConversationParticipant[]
  messages     Message[]

  @@map("conversation")
}

model ConversationParticipant {
  id               String       @id @default(cuid())
  joinedAt         DateTime     @default(now())
  isPinned         Boolean      @default(false)
  lastReadAt       DateTime?
  pinnedMessageIds String[]     @default([])
  userId           String
  conversationId   String
  conversation     Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  user             User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, conversationId])
  @@map("conversation_participant")
}

model Message {
  id             String            @id @default(cuid())
  content        String
  createdAt      DateTime          @default(now())
  read           Boolean           @default(false)
  readAt         DateTime?
  deletedForAll  Boolean           @default(false)
  senderId       String
  conversationId String
  conversation   Conversation      @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  sender         User              @relation(fields: [senderId], references: [id], onDelete: Cascade)
  deletions      MessageDeletion[]

  @@index([conversationId, createdAt])
  @@map("message")
}

model MessageDeletion {
  id        String   @id @default(cuid())
  messageId String
  userId    String
  deletedAt DateTime @default(now())
  message   Message  @relation(fields: [messageId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([messageId, userId])
  @@map("message_deletion")
}

enum StatutConvocation {
  EN_ATTENTE
  CONFIRME
  REFUSE
  EXPIRE
}

enum ConversationType {
  PRIVATE
  GROUP
}

enum TypeNotification {
  CONVOCATION_MATCH
  DEMANDE_ADHESION
  BLESSURE_DECLAREE
  FINANCE_ECHEANCE
  SONDAGE_NOUVEAU
  EVENEMENT_RAPPEL
  REJOINT_CLUB
  QUITTER_CLUB
  MESSAGE
}

enum Roles {
  Admin
  utilisateur
}

enum Plan {
  free
  pro
}

enum PlanAbonnement {
  mois
  // ann√©e
}

enum RoleEquipe {
  SANSCLUB
  ENTRAINEUR
  JOUEUR
}

enum PosteJoueur {
  GARDIEN
  DEFENSEUR_LATERAL_DROIT
  DEFENSEUR_CENTRAL
  DEFENSEUR_LATERAL_GAUCHE
  MILIEU_DEFENSIF
  MILIEU_CENTRAL
  MILIEU_OFFENSIF
  MILIEU_RECUPERATEUR
  MILIEU_RELAYEUR
  ATTAQUANT_DE_POINTE
  ATTAQUANT_DE_SOUTIEN
  AILIER_GAUCHE
  AILIER_DROIT
  SECOND_ATTAQUANT
}

enum TypeEvenement {
  ENTRAINEMENT
  CHAMPIONNAT
  COUPE
}

enum StatutPresence {
  ATTENTE
  PRESENT
  ABSENT
}

enum ResultatMatch {
  VICTOIRE
  DEFAITE
  NUL
}

enum competition {
  CHAMPIONNAT
  COUPE
}

enum StatutClub {
  PUBLIC
  PRIVE
  INVITATION
}

enum NiveauClub {
  DEPARTEMENTAL_1
  DEPARTEMENTAL_2
  DEPARTEMENTAL_3
  REGIONAL_1
  REGIONAL_2
  REGIONAL_3
  NATIONAL_1
  NATIONAL_2
  NATIONAL_3
  LOISIR
}

enum StatutDemande {
  ATTENTE
  ACCEPTEE
  REFUSEE
}

enum TypeFinance {
  COTISATION
  DEPENSE
}
